[qier222/YesPlayMusic: é«˜é¢œå€¼çš„ç¬¬ä¸‰æ–¹ç½‘æ˜“äº‘æ’­æ”¾å™¨ï¼Œæ”¯æŒ Windows / macOS / Linux (github.com)](https://github.com/qier222/YesPlayMusic)

---

## å‡†å¤‡

### 1. å›æ»šç½‘æ˜“äº‘ç‰ˆæœ¬

[ç½‘æ˜“äº‘éŸ³ä¹ å†å²ç‰ˆæœ¬æ”¶é›†](https://blog.amarea.cn/archives/netease-cloudmusic-history-version.html)

2.10 ä»¥åçš„ç‰ˆæœ¬å¤±æ•ˆäº†ï¼Œ**å»ºè®®ç”¨2.9.6åŠä»¥å‰çš„ç‰ˆæœ¬**

å®‰è£…å®Œæˆåè®°å¾—åœ¨è®¾ç½® > å…³äºç½‘æ˜“äº‘éŸ³ä¹ > å–æ¶ˆæ‰è‡ªåŠ¨æ›´æ–°

ç›¸å…³åŸå› è§ï¼š[Issue #824](https://github.com/nondanee/UnblockNeteaseMusic/issues/824)

### 2. å®‰è£… Node.js

- Windows

  [Download | Node.js](https://nodejs.org/en/download/)
  ä¸‹è½½ .msi å®‰è£…åŒ…å¹¶å®‰è£…

- macOS

  [Download | Node.js](https://nodejs.org/en/download/)
  ä¸‹è½½ .pkg å®‰è£…åŒ…å¹¶å®‰è£…

- Linux

  [Installing Node.js via package manager | Node.js](https://nodejs.org/en/download/package-manager/)
  å‚ç…§æ•™ç¨‹å®‰è£… nodejs

### 3. ä¸‹è½½é¡¹ç›®æºæ–‡ä»¶
[Githubä¸‹è½½](https://github.com/nondanee/UnblockNeteaseMusic/archive/refs/heads/master.zip) 
å› éœ€è¦ä¿®æ”¹è‡ªç­¾è¯ä¹¦ï¼Œéœ€è¦å¯¹åŸé¡¹ç›®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥è¦ä¸‹è½½æ•´ä¸ªé¡¹ç›®zipåŒ….

ä¸‹è½½å®Œæˆåè§£å‹ã€‚

## å¯åŠ¨

æ‰“å¼€é¡¹ç›®ç›®å½•å

Windows ç”¨æˆ·è¯·æŒ‰ä½ Shift åç‚¹å‡»å³é”®ï¼Œé€‰æ‹© "åœ¨æ­¤å¤„æ‰“å¼€ PowerShell çª—å£(S)"
macOS ç”¨æˆ·å¯ä»¥å€ŸåŠ© OpenInTerminalï¼ŒGo2Shell ç­‰å·¥å…·å¿«æ·æ‰“å¼€ç»ˆç«¯çª—å£

### æŸ¥çœ‹å‚æ•°è¯´æ˜

åœ¨ç»ˆç«¯è¾“å…¥

```sh
node app.js -h
```

è¾“å‡ºå¦‚ä¸‹ï¼š

```sh
$ node app.js -h
usage: unblockneteasemusic [-v] [-p port] [-a address] [-u url] [-f host]
                           [-o source [source ...]] [-t token] [-e url] [-s]
                           [-h]

optional arguments:
  -v, --version                   output the version number
  -p port, --port port            specify server port
  -a address, --address address   specify server host
  -u url, --proxy-url url         request through upstream proxy
  -f host, --force-host host      force the netease server ip
  -o source [source ...], --match-order source [source ...]
                                  set priority of sources
  -t token, --token token         set up proxy authentication
  -e url, --endpoint url          replace virtual endpoint with public host
  -s, --strict                    enable proxy limitation
  -h, --help                      output usage information
```

### å¯åŠ¨æœåŠ¡

ç”¨nodeå¯åŠ¨å…¥å£æ–‡ä»¶app.jsï¼Œå¹¶å›è½¦ã€‚æ³¨ï¼š-p ç”¨æ¥å‚æ•°æŒ‡å®šæœåŠ¡ç«¯å£ï¼Œæ­¤å¤„æˆ‘ä½¿ç”¨çš„æ˜¯54442å’Œ54443ï¼ˆä¸ªäººå–œå¥½ï¼‰ï¼Œåˆ†åˆ«ä¸ºhttpå’ŒhttpsæœåŠ¡ç«¯å£ï¼Œ

```sh
node app.js -p 54442:54443
```

æ­£å¸¸ä¼šçœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š

```
HTTP Server running @ http://0.0.0.0:54442
HTTPS Server running @ http://0.0.0.0:54443
```

å¦‚æœæ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è¯¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼ˆ`netstat -ano | find "54442"`ï¼‰ï¼Œæˆ–è€…å°è¯•ä»¥ç®¡ç†å‘˜èº«ä»½å¯åŠ¨

```
Server running @ http://0.0.0.0:54442
events.js:167
      throw er; // Unhandled 'error' event
      ^

Error: listen EACCES 0.0.0.0:80
    at Server.setupListenHandle [as _listen2] (net.js:1269:19)
    at listenInCluster (net.js:1334:12)
    at Server.listen (net.js:1421:7)
    at Promise.all.then.result (G:\NeteaseMusic\UnblockNeteaseMusic-master\app.js:58:9)
    at process._tickCallback (internal/process/next_tick.js:68:7)
Emitted 'error' event at:
    at emitErrorNT (net.js:1313:8)
    at process._tickCallback (internal/process/next_tick.js:63:19)
```



## ä»£ç†é…ç½®

PAC è‡ªåŠ¨ä»£ç†è„šæœ¬åœ°å€ `http://127.0.0.1:54442/proxy.pac`ï¼ˆåœ¨ä¸Šä¸€æ­¥æµ‹è¯•è¿è¡ŒæˆåŠŸåå¯ç”¨æµè§ˆå™¨æ‰“å¼€è¯¥åœ°å€ï¼‰

| å¹³å°    | åŸºç¡€è®¾ç½®                              |
| ------- | ------------------------------------- |
| Windows | è®¾ç½® > å·¥å…· > è‡ªå®šä¹‰ä»£ç† (å®¢æˆ·ç«¯å†…)   |
| UWP     | Windows è®¾ç½® > ç½‘ç»œå’Œ Internet > ä»£ç† |
| Linux   | ç³»ç»Ÿè®¾ç½® > ç½‘ç»œ > ç½‘ç»œä»£ç†            |
| macOS   | ç³»ç»Ÿåå¥½è®¾ç½® > ç½‘ç»œ > é«˜çº§ > ä»£ç†     |
| Android | WLAN > ä¿®æ”¹ç½‘ç»œ > é«˜çº§é€‰é¡¹ > ä»£ç†     |
| iOS     | æ— çº¿å±€åŸŸç½‘ > HTTP ä»£ç† > é…ç½®ä»£ç†     |



macOS çš„é…ç½®ï¼š

<img src="https://md-picture-1254350681.cos.ap-beijing.myqcloud.com/image-20210131003610533.png" alt="image-20210131003610533" style="zoom: 67%;" />

## Macä¸‹httpsè¯ä¹¦é…ç½®

### å‡†å¤‡è¯ä¹¦æ–‡ä»¶

å¯ä»¥ç›´æ¥ä½¿ç”¨é¡¹ç›®æ–‡ä»¶ä¸­çš„ server.crt å’Œ server.keyï¼Œè‹¥éœ€è‡ªå·±ç­¾å‘è¯ä¹¦ï¼Œæ­¥éª¤å¦‚ä¸‹ (éœ€è¦ç”¨åˆ° OpenSSL)

```sh
# ç”Ÿæˆ CA ç§é’¥
openssl genrsa -out ca.key 2048

# ç”Ÿæˆ CA è¯ä¹¦ ("YOURNAME" å¤„å¡«ä¸Šä½ è‡ªå·±çš„åå­—)
openssl req -x509 -new -nodes -key ca.key -sha256 -days 1825 -out ca.crt -subj "/C=CN/CN=UnblockNeteaseMusic Root CA/O=YOURNAME"

# ç”ŸæˆæœåŠ¡å™¨ç§é’¥
openssl genrsa -out server.key 2048

# ç”Ÿæˆè¯ä¹¦ç­¾å‘è¯·æ±‚
openssl req -new -sha256 -key server.key -out server.csr -subj "/C=CN/L=Hangzhou/O=NetEase (Hangzhou) Network Co., Ltd/OU=IT Dept./CN=*.music.163.com"

# ä½¿ç”¨ CA ç­¾å‘æœåŠ¡å™¨è¯ä¹¦
openssl x509 -req -extfile <(printf "extendedKeyUsage=serverAuth\nsubjectAltName=DNS:music.163.com,DNS:*.music.163.com") -sha256 -days 365 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt
```

ä¸Šè¿°æ­¥éª¤å®Œæˆåï¼Œå½“å‰ç›®å½•ä¸‹å…±æ–°ç”Ÿæˆ6ä¸ªæ–‡ä»¶

```sh
$ ls
ca.crt		ca.srl		server.csr
ca.key		server.crt	server.key
```

**å°†æœåŠ¡å™¨ç§é’¥ (server.key) å’ŒæœåŠ¡å™¨è¯ä¹¦ (server.crt) æ‹·è´åˆ°ä»“åº“ä¸­è¦†ç›–åŸæœ‰æ–‡ä»¶** (è‹¥ä½¿ç”¨ dockerï¼Œå¯é€šè¿‡æ·»åŠ  `-v /path/to/server.crt:/usr/src/app/server.crt -v /path/to/server.key:/usr/src/app/server.key` å‚æ•°æ˜ å°„æœ¬åœ°è·¯å¾„è¦†ç›–åŸæœ‰æ–‡ä»¶)ï¼Œ**å†å°† CA è¯ä¹¦ (ca.crt) å®‰è£…åˆ°ç³»ç»Ÿï¼›**

å¦‚æœä¸è‡ªè¡Œç­¾å‘ï¼Œç›´æ¥å®‰è£…ä»“åº“é‡Œçš„ CA è¯ä¹¦ ([ca.crt](https://raw.githubusercontent.com/nondanee/UnblockNeteaseMusic/master/ca.crt)) ä¹Ÿå¯ã€‚

### å®‰è£…è¯ä¹¦

**CA è¯ä¹¦éœ€è¦æ‰‹åŠ¨é…ç½®ä¸ºä¿¡ä»»ï¼Œåˆ‡è®°**

Macç³»ç»Ÿç”¨ `safari` æ‰“å¼€ [music.163.com](https://music.163.com/) ï¼Œå®ƒä¼šæç¤ºä½ è¯ä¹¦é”™è¯¯ï¼Œç‚¹å‡» ã€Œè®¿é—®æ­¤ç½‘ç«™ã€åè¾“å…¥å¯†ç å®‰è£…è¯ä¹¦å³å¯

<img src="https://md-picture-1254350681.cos.ap-beijing.myqcloud.com/image-20210131002756430.png" alt="image-20210131002756430" style="zoom: 50%;" />

â€‹	(iOS ä¸Šå®¹æ˜“é—æ¼çš„æ­¥éª¤ ğŸ‘‰ https://support.apple.com/zh-cn/HT204477)



## ğŸ¶Music

OKï¼Œ ç°åœ¨ä½ å¯ä»¥æ‰“å¼€ç½‘æ˜“äº‘å®¢æˆ·ç«¯ä¸‹è½½åŸæ¥æ˜¾ç¤ºä¸ºç°è‰²çš„éŸ³ä¹äº†



ç¨‹åºä¼šè¾“å‡ºç±»ä¼¼å¦‚ä¸‹æ—¥å¿—ä¿¡æ¯ï¼š

```
HTTP Server running @ http://0.0.0.0:54442
HTTPS Server running @ http://0.0.0.0:54443
MITM > music.163.com 
TUNNEL > localhost:54443
MITM > music.163.com (ssl)
MITM > music.163.com (ssl)
TUNNEL > localhost:54443
TUNNEL > localhost:54443
TUNNEL > localhost:54443
```

å½“ç„¶ä½ å¯ä»¥é€šè¿‡å„ç§æ–¹å¼è®©å…¶æ”¾åœ¨åå°è¿è¡Œï¼Œä¾‹å¦‚ nohup æˆ–è€… pm2ç­‰ã€‚

```sh
nohup node app.js -p 54442:54443 >/dev/null 2>&1 &
```

or

```sh
npm install -g pm2  # å®‰è£…pm2
pm2 start app.js -- -p 54442:54443   # å¯åŠ¨é¡¹ç›®

pm2 list  # æŸ¥çœ‹è¿è¡Œé¡¹ç›®
pm2 stop all  # åœæ­¢æ‰€æœ‰è¿è¡Œé¡¹ç›®
pm2 startup  # pm2è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨
```

å…¶ä»–é…ç½®æ­¥éª¤è¯·å‚è€ƒä»¥ä¸‹é“¾æ¥ï¼Œåå‘ä»£ç†ã€è®¾ç½®éŸ³æºç­‰ç­‰ã€‚

## ç›¸å…³é“¾æ¥

- [UnblockNeteaseMusicé¡¹ç›®åœ°å€](https://github.com/nondanee/UnblockNeteaseMusic)
- [é£Ÿç”¨æŒ‡å—](https://github.com/nondanee/UnblockNeteaseMusic/issues/22)
- [è¿›é˜¶é…ç½®](https://github.com/nondanee/UnblockNeteaseMusic/issues/48)
- [other](https://github.com/nondanee/UnblockNeteaseMusic/issues/22#issuecomment-436505087)