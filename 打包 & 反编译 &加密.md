[toc]

# ä¸€ã€ç¼–è¯‘

æç¤ºï¼šç¼–è¯‘è¿‡ç¨‹ä¸­æ‰€æœ‰æ–‡ä»¶è·¯å¾„æœ€å¥½ä¸è¦å‡ºç°ä¸­æ–‡

## 1. ç¼–è¯‘ä¸º pyc

### è¯´æ˜

ç®€å•æ¥è¯´ï¼Œpyc æ–‡ä»¶å°±æ˜¯ Python çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œpyc æ–‡ä»¶åªæœ‰åœ¨æ–‡ä»¶è¢«å½“æˆæ¨¡å—å¯¼å…¥æ—¶æ‰ä¼šç”Ÿæˆã€‚ç”Ÿæˆ pyc æ–‡ä»¶çš„å¥½å¤„æ˜¾è€Œæ˜“è§ï¼Œå½“æˆ‘ä»¬å¤šæ¬¡è¿è¡Œç¨‹åºæ—¶ï¼Œä¸éœ€è¦é‡æ–°å¯¹è¯¥æ¨¡å—è¿›è¡Œé‡æ–°çš„è§£é‡Šã€‚å½“æˆ‘ä»¬ä¹‹å‰æœ‰å¯åŠ¨é¡¹ç›®æˆåŠŸæ—¶ï¼Œpython è‡ªåŠ¨å°±ä¼šåˆ›å»ºåœ¨æ¯ä¸€çº§æœ‰è°ƒç”¨åˆ°æ–‡ä»¶çš„ç›®å½•ä¸€ä¸ªå«\_\_pycache\_\_çš„æ–‡ä»¶å¤¹å½“æˆç¼“å­˜ã€‚

.pyc æ–‡ä»¶ç»“æ„ä»‹ç»å‚è€ƒï¼š<https://www.iteye.com/topic/382423>
.pyc æ–‡ä»¶çš„å‰ 8 ä¸ªå­—èŠ‚å«ä¹‰ï¼š

- å››ä¸ªå­—èŠ‚çš„ magic number
- å››ä¸ªå­—èŠ‚çš„ timestamp

å¤´å››ä¸ªæ˜¯ magic number å¾ˆå¤š pyc éƒ½åœ¨è¿™ä¸ªä¸Šé¢åšæ–‡ç« ï¼Œè¿™ä¿®æ”¹æˆä¸åˆæ³•çš„ï¼Œç„¶åä½ åç¼–è¯‘å°±æ˜¯è´¥äº†ï¼Œä½ å¯ä»¥æ‰¾ä½ è‡ªå·±ç¼–è¯‘æˆåŠŸçš„ pyc å¤´ç›´æ¥è¦†ç›–æ‰ä»–çš„å¤´ 8 ä¸ªå­—èŠ‚å°±å¯ä»¥äº†ï¼Œ **timestamp æ˜¯æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼Œä¸»è¦æ˜¯å½“æºç æœ‰æ”¹å˜çš„æ—¶å€™ python å°±å¯ä»¥é‡æ–°ç”Ÿæˆ pyc æ–‡ä»¶.**

### ç¼–è¯‘æ–¹æ³•

åˆ©ç”¨`compileall`å’Œ`py_compile`æ¥é¢„ç¼–è¯‘ python ä»£ç ï¼š
è¿™ä¸¤ä¸ªä»æŸç§æ„ä¹‰ä¸Šæ˜¯äº’é€šçš„ï¼Œpython é¢„è£…äº†è¿™ä¸¤ä¸ªä¸œè¥¿ï¼Œ

```sh
python -m compileall test.py #æŠŠå•ä¸ª.pyæ–‡ä»¶ç¼–è¯‘ä¸ºå­—èŠ‚ç æ–‡ä»¶
python -m compileall /path/src/ #æ‰¹é‡ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ï¼Œ/path/src/æ˜¯åŒ…å«.pyæ–‡ä»¶åçš„è·¯å¾„

python -m py_compile test.py #æŠŠå•ä¸ª.pyæ–‡ä»¶ç¼–è¯‘ä¸ºå­—èŠ‚ç æ–‡ä»¶
python -m py_compile /path/src/ #æ‰¹é‡ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ï¼Œä»…å°†/path/src/çš„ä¸‹ä¸€å±‚.pyæ–‡ä»¶ç¼–è¯‘ï¼Œä¸ä¼šé€’å½’æ‰§è¡Œ
```

ä¸Šé¢çš„ py_compile é’ˆå¯¹æ–‡ä»¶å¤¹æ˜¯ä¼šæœ‰ä¸€äº›é—®é¢˜ï¼Œä½†ç†è®ºä¸Šè¿™ç§è¯­æ³•åº”è¯¥æ˜¯å¯ä»¥çš„ã€‚
å¯æ ¹æ®é¡¹ç›®éœ€è¦å†™æˆç¼–è¯‘è„šæœ¬ï¼š

```python
import compileall

compileall.compile_dir('Lib/', force=True)

# Perform same compilation, excluding files in .svn directories.
import re
compileall.compile_dir('Lib/', rx=re.compile(r'[/\\][.]svn'), force=True)

# pathlib.Path objects can also be used.
import pathlib
compileall.compile_dir(pathlib.Path('Lib/'), force=True)
```

å¯¹äº compileall æ›´è¯¦ç»†çš„å‚æ•°ä»¥åŠå‘½ä»¤è§£æå¯ä»¥å‚è€ƒçš„é“¾æ¥ï¼š<https://docs.python.org/3/library/compileall.html>

```python
import py_compile
def compile(file, cfile=None, dfile=None, doraise=False, optimize=-1,
            invalidation_mode=None):
```

- file: è¡¨ç¤ºéœ€è¦ç¼–è¯‘çš„ py æ–‡ä»¶çš„è·¯å¾„
- cfile: è¡¨ç¤ºç¼–è¯‘åçš„ pyc æ–‡ä»¶åç§°å’Œè·¯å¾„ï¼Œé»˜è®¤ä¸ºç›´æ¥åœ¨ file æ–‡ä»¶åååŠ  c æˆ–è€… oï¼Œo è¡¨ç¤ºä¼˜åŒ–çš„å­—èŠ‚ç 
- dfileï¼š é”™è¯¯æ¶ˆæ¯ä¿å­˜çš„è·¯å¾„ï¼Œé»˜è®¤ä¸ºæºæ–‡ä»¶å
- doraise: å¦‚æœä¸º `True`ï¼Œç¼–è¯‘å‘ç”Ÿé”™è¯¯æ—¶åˆ™ä¼šå¼•å‘ä¸€ä¸ª PyCompileErrorï¼› å¦‚æœä¸º`False`, ç¼–è¯‘æ–‡ä»¶å‡ºé”™æ—¶ï¼Œåˆ™ä¼šæœ‰è¾“å‡ºä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œè€Œä¸ä¼šå¼•å‘å¼‚å¸¸
- optimize: ç¼–è¯‘ä¼˜åŒ–ç­‰çº§ï¼Œå¯å–-1, 0, 1, 2. å€¼-1 è¡¨ç¤ºä½¿ç”¨å½“å‰è§£é‡Šå™¨çš„ä¼˜åŒ–ç­‰çº§ï¼Œå…¶ä»–å€¼ç”±-O æŒ‡å®šã€‚

### ä½¿ç”¨

æœ€å¥½å°†æ–‡ä»¶åä¸­é—´ç±»ä¼¼ cpython-36 çš„éƒ¨åˆ†å»æ‰ï¼Œå¦åˆ™å¯èƒ½å‡ºç°å¯¼åŒ…é”™è¯¯ ModuleNotFoundError:

## 2. ç¼–è¯‘ä¸º pyo æˆ–è€… opt-n.pyc æ–‡ä»¶

### è¯´æ˜

æºä»£ç æ–‡ä»¶ç»è¿‡ä¼˜åŒ–ç¼–è¯‘åç”Ÿæˆçš„æ–‡ä»¶ï¼Œæ— æ³•ç”¨æ–‡æœ¬ç¼–è¾‘å™¨è¿›è¡Œç¼–è¾‘
Python3.5 ä¹‹åï¼Œä¸å†ä½¿ç”¨.pyo æ–‡ä»¶åï¼Œè€Œæ˜¯ä½¿ç”¨ç±»ä¼¼â€œxxx.opt-n.pyc çš„æ–‡ä»¶åï¼›
ç¼–è¯‘æˆ pyc å’Œ pyo æœ¬è´¨ä¸Šå’Œ py æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œåªæ˜¯å¯¹äºè¿™ä¸ªæ¨¡å—çš„åŠ è½½é€Ÿåº¦æé«˜äº†ï¼Œå¹¶æ²¡æœ‰æé«˜ä»£ç çš„æ‰§è¡Œé€Ÿåº¦ã€‚

### ç¼–è¯‘æ–¹æ³•

pyo æ–‡ä»¶å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸Šé¢ pyc å‘½ä»¤çš„æ”¹ç‰ˆï¼š

```sh
python -O -m py_compile file.py
python -O -m py_compile /path/src/
python -O -m compileall file.py
python -O -m compileall /path/src/

æˆ–è€…
python -OO -m py_compile file.py
python -OO -m py_compile /path/src/
python -OO -m compileall file.py
python -OO -m compileall /path/src/
```

### è¿è¡Œ

ç­‰ç­‰ç­‰ç­‰

## 3. ç¼–è¯‘æˆ pyd æˆ– so é“¾æ¥åº“

### è¯´æ˜

pyd æ ¼å¼æ˜¯ D è¯­è¨€(C/C++ç»¼åˆè¿›åŒ–ç‰ˆæœ¬)ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶
windows ç¼–è¯‘ç¯å¢ƒé„™äººç”¨çš„ Visual Studio 2019

### ç¼–è¯‘æ–¹æ³•ä¸€

#### Cython

åˆ©ç”¨ Cython æ¨¡å—ï¼Œæ ¹æ®ç¼–è¯‘ç¯å¢ƒä¸åŒç”Ÿæˆä¸åŒæ–‡ä»¶ã€‚

- å‰æå®‰è£… Cython

```sh
pip intall Cython
```

- ç¼–è¾‘ä¸€ä¸ª setup.py æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹ä»£ç å¹¶è¿è¡Œ

**æ³¨æ„**ï¼šç¨‹åºæ‰€åœ¨çš„ç›®å½•è·¯å¾„ä¸èƒ½åŒ…å«ä¸­æ–‡æ–‡å­—

```python

# è„šæœ¬æ–‡ä»¶
from distutils.core import setup
from Cython.Build import cythonize

setup(
  name = 'Hello world app',
  ext_modules = cythonize("test.py"),
)
```

ç„¶åæˆ‘ä»¬å°±é€€å›åˆ°ç›®å½•ä¸‹è¿è¡Œå‘½ä»¤ï¼Œå°±ä¼šåœ¨ windows ä¸Šç”Ÿæˆ pyd æ–‡ä»¶ï¼Œæˆ–è€… linux ä¸Šç”Ÿæˆ so æ–‡ä»¶ï¼š

```sh
python setup.py build_ext --inplace
```

**--inplace çš„æ„æ€æ˜¯åœ¨å½“å‰æ–‡ä»¶ç›®å½•ä¸‹ç”Ÿæˆ.pyd æ–‡ä»¶ï¼Œä¸åŠ è¿™ä¸€å¥å°±ä¼šåœ¨ build æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆ**

æœ€ç»ˆç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ï¼š
![build](./img/build.png)
å…¶ä¸­ï¼Œbuild æ˜¯ç”Ÿæˆè¿‡ç¨‹ä½¿ç”¨åˆ°çš„ä¸´æ—¶æ–‡ä»¶ã€‚test.c ä¹Ÿæ˜¯ä¸´æ—¶æ–‡ä»¶
æ³¨ï¼šå¯èƒ½ä¼šå‡ºç°â€œUnable to find vcvarsall.batâ€é”™è¯¯
![vcvarsall.baté”™è¯¯](./img/vcvarsall.png)
å‚è€ƒè¿™é‡Œ

- [ä¿®æ”¹ Python å®‰è£…ç›®å½•çš„æ–‡ä»¶è®¾ç½®](http://www.cnblogs.com/lazyboy/p/4017567.html)
- [How to deal with the pain of â€œunable to find vcvarsall.batâ€](https://blogs.msdn.microsoft.com/pythonengineering/2016/04/11/unable-to-find-vcvarsall-bat/#comments)

### ç¼–è¯‘æ–¹æ³•äºŒ

#### å®‰è£… easycython

è¿™ä¸ªæœ€æ–¹ä¾¿åªè¦ä¸€è¡Œä»£ç å°±å¯ä»¥æå®šã€‚
<https://github.com/cjrh/easycython>

```sh
pip install easycython
```

è¿™ä¸ªæ¨¡å—ä¹Ÿä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–çš„ cython

#### è½¬æ¢æ­¥éª¤

å°† \.py æ–‡ä»¶é‡å‘½åä¸º.pyx
è¿è¡Œå‘½ä»¤

```sh
easycython *.pyx
```

ä¸Šé¢ä¼šå°†å½“å‰æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„.pyx æ–‡ä»¶ç”Ÿæˆä¸º.pyd (Linux ä¸‹æ˜¯\.so)

![easy](./img/easycython.png)

html æ–‡ä»¶å¯ä»¥æŸ¥çœ‹ .py æ–‡ä»¶ä¸ .c æ–‡ä»¶çš„è½¬æ¢å¯¹ç…§å…³ç³»ã€‚
![show](img/test_html.png)

### ä½¿ç”¨å»ºè®®

**åŒæ ·çš„ï¼Œæœ€å¥½é‡å‘½å pyd æ–‡ä»¶åï¼Œå°†ä¸­é—´çš„éƒ¨åˆ†åˆ é™¤ï¼Œå‰åéƒ¨åˆ†ä¸è¦åŠ¨**
å¯ä»¥é€šè¿‡`import test`ä½¿ç”¨è¯¥æ–‡ä»¶

![hello](./img/hello.png)

**ä¸ªäººå»ºè®®**ï¼šå°†æ ¸å¿ƒçš„ä»£ç ç¼–è¯‘ä¸º pyd æˆ–è€… so æ–‡ä»¶ï¼Œç„¶åå†å†™ä¸€ä¸ªç®€å•çš„ main.py å» import è°ƒç”¨è¿™äº›é“¾æ¥åº“æ–‡ä»¶ï¼Œè¾¾åˆ°éšè—æ ¸å¿ƒä»£ç çš„ä½œç”¨ã€‚

å¦å¤–ï¼Œcython åœ¨ jupyter notebook é‡Œä½¿ç”¨çœŸçš„å¾ˆåˆºæ¿€ ğŸ˜±ğŸ˜±
![j_c](./img/jupyter_cython.png)
å…³äº cython ä¸ python æ··åˆç¼–ç¨‹çš„ä½¿ç”¨å¯ä»¥å‚è€ƒï¼š

- <http://docs.cython.org/en/latest/src/quickstart/overview.html>
- <https://blog.csdn.net/g6uqwseseo/article/details/71439453?locationNum=11&fps=1>

# äºŒã€æ‰“åŒ…

å„ç§æ‰“åŒ…å·¥å…·çš„å¯¹æ¯”å¦‚ä¸‹(æ¥è‡ªæ–‡ç« [Freezing Your Code](http://docs.python-guide.org/en/latest/shipping/freezing/))

| Solution    | Windows | Linux | OS X | Python 3 | License | One-file mode | Zipfile import | Eggs | pkg_resources support |
| ----------- | ------- | ----- | ---- | -------- | ------- | ------------- | -------------- | ---- | --------------------- |
| bbFreeze    | yes     | yes   | yes  | no       | MIT     | no            | yes            | yes  | yes                   |
| py2exe      | yes     | no    | no   | yes      | MIT     | yes           | yes            | no   | no                    |
| pyInstaller | yes     | yes   | yes  | no       | GPL     | yes           | no             | yes  | no                    |
| cx_Freeze   | yes     | yes   | yes  | yes      | PSF     | no            | yes            | yes  | no                    |
| py2app      | no      | no    | yes  | yes      | MIT     | no            | yes            | yes  | yes                   |

å…¶ä¸­ **pyInstaller** å’Œ **cx_Freeze** éƒ½æ˜¯ä¸é”™çš„ï¼Œstackoverflow ä¸Šä¹Ÿæœ‰äººå»ºè®®ç”¨ cx_Freezeï¼Œè¯´æ˜¯æ›´ä¾¿æ·äº›ã€‚pkg_resources æ–°ç‰ˆçš„ pyInstaller è²Œä¼¼æ˜¯æ”¯æŒçš„ã€‚

[PyInstaller å®˜æ–¹ WIKI](http://pythonhosted.org/PyInstaller)

PyInstaller çš„åŸç†ç®€ä»‹
PyInstaller å…¶å®å°±æ˜¯æŠŠ python è§£æå™¨å’Œä½ è‡ªå·±çš„è„šæœ¬æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œå’Œç¼–è¯‘æˆçœŸæ­£çš„æœºå™¨ç å®Œå…¨æ˜¯ä¸¤å›äº‹ï¼Œæ‰€ä»¥åƒä¸‡ä¸è¦æŒ‡æœ›æˆæ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¼šæé«˜è¿è¡Œæ•ˆç‡ï¼Œç›¸åå¯èƒ½ä¼šé™ä½è¿è¡Œæ•ˆç‡ï¼Œå¥½å¤„å°±æ˜¯åœ¨è¿è¡Œè€…çš„æœºå™¨ä¸Šä¸ç”¨å®‰è£… python å’Œä½ çš„è„šæœ¬ä¾èµ–çš„åº“ã€‚åœ¨ Linux æ“ä½œç³»ç»Ÿä¸‹ï¼Œå®ƒä¸»è¦ç”¨çš„ binutil å·¥å…·åŒ…é‡Œé¢çš„ ldd å’Œ objdump å‘½ä»¤ã€‚

PyInstaller è¾“å…¥ä½ æŒ‡å®šçš„çš„è„šæœ¬ï¼Œé¦–å…ˆåˆ†æè„šæœ¬æ‰€ä¾èµ–çš„å…¶ä»–è„šæœ¬ï¼Œç„¶åå»æŸ¥æ‰¾ï¼Œå¤åˆ¶ï¼ŒæŠŠæ‰€æœ‰ç›¸å…³çš„è„šæœ¬æ”¶é›†èµ·æ¥ï¼ŒåŒ…æ‹¬ Python è§£æå™¨ï¼Œç„¶åæŠŠè¿™äº›æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œæˆ–è€…æ‰“åŒ…è¿›ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶é‡Œé¢ã€‚

å¯ä»¥ç›´æ¥å‘å¸ƒè¾“å‡ºçš„æ•´ä¸ªæ–‡ä»¶å¤¹é‡Œé¢çš„æ–‡ä»¶ï¼Œæˆ–è€…ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä½ åªéœ€è¦å‘Šè¯‰ç”¨æˆ·ï¼Œä½ çš„åº”ç”¨ App æ˜¯è‡ªæˆ‘åŒ…å«çš„ï¼Œä¸éœ€è¦å®‰è£…å…¶ä»–åŒ…ï¼Œæˆ–æŸä¸ªç‰ˆæœ¬çš„ Pythonï¼Œå°±å¯ä»¥ç›´æ¥è¿è¡Œäº†ã€‚

**éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPyInstaller æ‰“åŒ…çš„æ‰§è¡Œæ–‡ä»¶ï¼Œåªèƒ½åœ¨å’Œæ‰“åŒ…æœºå™¨ç³»ç»ŸåŒæ ·çš„ç¯å¢ƒä¸‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å…·å¤‡å¯ç§»æ¤æ€§ï¼Œè‹¥éœ€è¦åœ¨ä¸åŒç³»ç»Ÿä¸Šè¿è¡Œï¼Œå°±å¿…é¡»é’ˆå¯¹è¯¥å¹³å°è¿›è¡Œæ‰“åŒ…ã€‚**

# ä¸‰ã€åç¼–è¯‘

## 1. pyc æ–‡ä»¶åç¼–è¯‘

1. åœ¨çº¿ç½‘ç«™ï¼š<https://tool.lu/pyc/> ï¼ˆæ•ˆæœå¥½åƒä¸å¤ªå¥½ï¼‰

2. uncompyle6

   - å®‰è£…

   ```sh
   pip install uncompyle6
   ```

   - ä½¿ç”¨
     å°† models.pyc åç¼–è¯‘æˆ py æ–‡ä»¶

   ```sh
    uncompyle6 models.pyc > models.py
   ```

   å°†å½“å‰æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰çš„ \.pyc æ–‡ä»¶åç¼–è¯‘æˆåç¼€åä¸º \.py çš„æºæ–‡ä»¶

   ```sh
   uncompile -o . *.pyc
   ```

   åç¼–è¯‘åçš„æ•ˆæœå¯ä»¥è¯´å¾ˆç†æƒ³ï¼Œå¦‚æœä½ çš„ä»£ç æ ¼å¼ç¬¦åˆ PEP8 è§„èŒƒçš„è¦æ±‚ï¼Œé‚£å°±åŸºæœ¬å’Œæºæ¥çš„æ–‡ä»¶ä¸€æ ·ï¼Œä¸è¿‡å„ç§æ³¨é‡Šå°±æ²¡æœ‰äº†ã€‚

   æŸ¥çœ‹æ›´å¤šç”¨æ³•ï¼š

   > uncompyle6 --help

   ```sh

   Usage:
   uncompyle6 [OPTIONS]... [ FILE | DIR]...
   uncompyle6 [--help | -h | --V | --version]

   Examples:
   uncompyle6      foo.pyc bar.pyc       # decompile foo.pyc, bar.pyc to stdout
   uncompyle6 -o . foo.pyc bar.pyc       # decompile to ./foo.pyc_dis and ./bar.pyc_dis
   uncompyle6 -o /tmp /usr/lib/python1.5 # decompile whole library

   Options:
   -o <path>     output decompiled files to this path:
                   if multiple input files are decompiled, the common prefix
                   is stripped from these names and the remainder appended to
                   <path>
                   uncompyle6 -o /tmp bla/fasel.pyc bla/foo.pyc
                       -> /tmp/fasel.pyc_dis, /tmp/foo.pyc_dis
                   uncompyle6 -o /tmp bla/fasel.pyc bar/foo.pyc
                       -> /tmp/bla/fasel.pyc_dis, /tmp/bar/foo.pyc_dis
                   uncompyle6 -o /tmp /usr/lib/python1.5
                       -> /tmp/smtplib.pyc_dis ... /tmp/lib-tk/FixTk.pyc_dis
   --compile | -c <python-file>
                   attempts a decompilation after compiling <python-file>
   -d            print timestamps
   -p <integer>  use <integer> number of processes
   -r            recurse directories looking for .pyc and .pyo files
   --fragments   use fragments deparser
   --verify      compare generated source with input byte-code
   --verify-run  compile generated source, run it and check exit code
   --syntax-verify compile generated source
   --linemaps    generated line number correspondencies between byte-code
                   and generated source output
   --encoding  <encoding>
                   use <encoding> in generated source according to pep-0263
   --help        show this message

   Debugging Options:
   --asm     | -a        include byte-code       (disables --verify)
   --grammar | -g        show matching grammar
   --tree={before|after}
   -t {before|after}     include syntax before (or after) tree transformation
                           (disables --verify)
   --tree++ | -T         add template rules to --tree=before when possible

   Extensions of generated files:
   '.pyc_dis' '.pyo_dis'   successfully decompiled (and verified if --verify)
       + '_unverified'       successfully decompile but --verify failed
       + '_failed'           decompile failed (contact author for enhancement)
   ```

3. å…¶ä»–åº“ uncompyle2ï¼Œ decompyle2, DePython, unpyc, uncompyle, pycdc

## exe åç¼–è¯‘

é’ˆå¯¹ pyinstaller æ‰“åŒ…çš„ç¨‹åºç ´è§£ï¼š

---

# å››ã€æ··æ·†åŠ å¯†

å‚è€ƒæ–‡ç« ï¼š

- [å¦‚ä½•ä¿æŠ¤ä½ çš„ Python ä»£ç  ï¼ˆä¸€ï¼‰â€”â€” ç°æœ‰åŠ å¯†æ–¹æ¡ˆ](https://zhuanlan.zhihu.com/p/54296517)

- [python ä»£ç æ··æ·†å·¥å…·æ±‡æ€»](https://www.cnblogs.com/bonelee/p/8603284.html)

## 1. ä»£ç æ··æ·†

å¦‚æœä»£ç è¢«æ··æ·†åˆ°ä¸€å®šç¨‹åº¦ï¼Œè¿ä½œè€…çœ‹ç€éƒ½è´¹åŠ²çš„è¯ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿèƒ½è¾¾åˆ°ä¿æŠ¤æºç çš„ç›®çš„å‘¢ï¼Ÿ

æ—¢ç„¶æˆ‘ä»¬çš„ç›®çš„æ˜¯æ··æ·†ï¼Œå°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„è½¬æ¢ï¼Œè®©ä»£ç é€æ¸ä¸è®©äººé‚£ä¹ˆå®¹æ˜“æ˜ç™½ï¼Œé‚£å°±å¯ä»¥è¿™æ ·ä¸‹æ‰‹ï¼š

- ç§»é™¤æ³¨é‡Šå’Œæ–‡æ¡£ã€‚æ²¡æœ‰è¿™äº›è¯´æ˜ï¼Œåœ¨ä¸€äº›å…³é”®é€»è¾‘ä¸Šå°±æ²¡é‚£ä¹ˆå®¹æ˜“æ˜ç™½äº†ã€‚
- æ”¹å˜ç¼©è¿›ã€‚å®Œç¾çš„ç¼©è¿›çœ‹ç€æ‰èˆ’æœï¼Œå¦‚æœç¼©è¿›å¿½é•¿å¿½çŸ­ï¼Œçœ‹ç€ä¹Ÿä¸€å®šé—¹å¿ƒã€‚
- åœ¨ tokens ä¸­é—´åŠ å…¥ä¸€å®šç©ºæ ¼ã€‚è¿™å°±å’Œæ”¹å˜ç¼©è¿›çš„æ•ˆæœå·®ä¸å¤šã€‚
- é‡å‘½åå‡½æ•°ã€ç±»ã€å˜é‡ã€‚å‘½åç›´æ¥å½±å“äº†å¯è¯»æ€§ï¼Œä¹±ä¸ƒå…«ç³Ÿçš„åå­—å¯æ˜¯é˜…è¯»ç†è§£çš„ä¸€å¤§éšœç¢ã€‚
- åœ¨ç©ºç™½è¡Œæ’å…¥æ— æ•ˆä»£ç ã€‚è¿™å°±æ˜¯éšœçœ¼æ³•ï¼Œç”¨æ— å…³ä»£ç æ¥æ‰“ä¹±é˜…è¯»èŠ‚å¥ã€‚

### 1.1 åœ¨çº¿ç½‘ç«™ï¼š<http://pyob.oxyry.com/>

#### ä½¿ç”¨æ–¹æ³•

ä¸‹æ‹‰èœå•é€‰æ‹©æ··æ·†æ–¹å¼ï¼Œè¿˜æœ‰åº•éƒ¨çš„é€‰é¡¹ï¼Œå°†ä»£ç å¡«åˆ°å·¦ä¾§æ–‡æœ¬æ¡†ï¼Œç‚¹å‡»ä¸Šæ–¹çº¢è‰²æŒ‰é’®ï¼Œå³å¯ç”Ÿæˆã€‚
![é¢„è§ˆ](./img/åœ¨çº¿æ··æ·†.png)

#### è¯´æ˜

æ­¤æ–¹å¼ä»…ä»…æ˜¯å°†å˜é‡æ›¿æ¢ä¸º O ã€0 ç»„åˆçš„å­—ç¬¦ä¸²ï¼Œè®©äººéš¾ä»¥ç›´æ¥é˜…è¯»ï¼Œä½†æ˜¯ä»£ç ç»“æ„ä»¥åŠå¯¼å…¥çš„åŒ…åæ²¡å˜ï¼Œå°†è¿™äº› 0O ç»„åˆçš„å˜é‡ååšç®€å•æ›¿æ¢ï¼Œå†é€šè¿‡ debug ç­‰æ–¹å¼è¿˜æ˜¯èƒ½äº†è§£ä»£ç çš„æ•´ä½“è¿è¡Œæµç¨‹çš„ã€‚

å¯ä»¥å†é…åˆå…¶ä»–åŠ å¯†æ–¹å¼ï¼Œå¢åŠ ç ´è§£éš¾åº¦ï¼Œå“ˆå“ˆã€‚

è¿™ä¸ªæ··æ·†ç®—æ³•ä¹Ÿå¯ä»¥è‡ªå·±å®ç°ã€‚QAQ

### 1.2 Intensio-Obfuscator

Intensio-Obfuscator å¯ä»¥ç›´æ¥å°† Python æºä»£ç è¿›è¡Œè½¬æ¢ï¼Œå¹¶è¾“å‡ºç»è¿‡æ··æ·†å¤„ç†åçš„ Python ä»£ç ã€‚å®ƒä¼šè‡ªåŠ¨å°†å˜é‡åã€ç±»åä»¥åŠå‡½æ•°åæ›¿æ¢ä¸ºéšæœºå­—ç¬¦ï¼Œå¹¶å®šä¹‰é•¿åº¦ï¼Œç§»é™¤æ³¨é‡Šå†…å®¹ï¼Œè‡ªåŠ¨æ¢è¡Œï¼Œå¹¶ç»™æ¯ä¸€è¡Œä»£ç å¢åŠ éšæœºè„šæœ¬ï¼ˆæ‰€æœ‰çš„éšæœºå€¼éƒ½æ˜¯ä¸åŒçš„ï¼‰ã€‚

æ”¯æŒçš„ Python æ–‡ä»¶ä»£ç ç‰ˆæœ¬ä¸º v2.x ä»¥åŠ v3.x ç‰ˆæœ¬.

[Github åœ°å€](https://github.com/Hnfull/Intensio-Obfuscator)

#### åŠŸèƒ½ä»‹ç»

- æ›¿æ¢ï¼šæ›¿æ¢æ‰€æœ‰çš„å˜é‡åã€ç±»åä»¥åŠå‡½æ•°åï¼Œç§»é™¤æ‰€æœ‰çš„æ¢è¡Œç¬¦
- å¡«å……ï¼šåœ¨æ¯ä¸€è¡Œä»£ç åæ·»åŠ éšæœºè„šæœ¬ï¼Œå¹¶ç§»é™¤æ‰€æœ‰çš„æ¢è¡Œç¬¦
- ç§»é™¤ï¼šç§»é™¤ä»£ç ä¸­çš„å…¨éƒ¨æ³¨é‡Šä»¥åŠæ¢è¡Œ
- ä½çº§æ··æ·†ï¼šç”Ÿæˆ 32 ä¸ªå­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²ï¼Œæ›¿æ¢æºä»£ç ä¸­å®šä¹‰çš„å˜é‡åã€ç±»åä»¥åŠå‡½æ•°å
- ä¸­çº§æ··æ·†ï¼šç”Ÿæˆ 64 ä¸ªå­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²ï¼Œæ›¿æ¢æºä»£ç ä¸­å®šä¹‰çš„å˜é‡åã€ç±»åä»¥åŠå‡½æ•°å
- é«˜çº§æ··æ·†ï¼šç”Ÿæˆ 128 ä¸ªå­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²ï¼Œæ›¿æ¢æºä»£ç ä¸­å®šä¹‰çš„å˜é‡åã€ç±»åä»¥åŠå‡½æ•°å

#### å·¥å…·ä½¿ç”¨

```sh
git clone https://github.com/Hnfull/Intensio-Obfuscator.git
pip3 install -r Intensio-Obfuscator/requirements.txt
cd Intensio-Obfuscator/intensio/

python intensio_obfuscator.py --help
```

| å‚æ•°               | æè¿°                                                                              |
| ------------------ | --------------------------------------------------------------------------------- |
| -h, â€“help          | æ˜¾ç¤ºå¸®åŠ©èœå•                                                                      |
| -f, â€“onefile       | æŒ‡å®šä¸€ä¸ªä»£ç æ–‡ä»¶                                                                  |
| -d, â€“multiplefiles | æŒ‡å®šå¤šä¸ªä»£ç æ–‡ä»¶ï¼ˆé¡¹ç›®ï¼‰                                                          |
| -i, â€“input         | æºæ–‡ä»¶æˆ–ç›®å½•                                                                      |
| -c, â€“code          | è¾“å…¥æ–‡ä»¶æˆ–ç›®å½•ä¸­ä½¿ç”¨çš„è¯­è¨€ï¼Œé»˜è®¤å€¼ä¸º[python]                                      |
| -o, â€“output        | æ··æ·†å¤„ç†åçš„è¾“å‡ºæ–‡ä»¶æˆ–ç›®å½•                                                        |
| -m, â€“mixer         | è¾“å‡ºå˜é‡æ··æ·†çš„å­—ç¬¦æ•°é‡/é•¿åº¦ï¼Œé»˜è®¤å€¼ä¸º: [medium]ï¼Œå¯é€‰é¡¹ä¸ºï¼š [lower, medium, high] |
| -r, â€“replace       | æ¿€æ´»â€œæ›¿æ¢â€æ··æ·†åŠŸèƒ½                                                                |
| -p, â€“padding       | æ¿€æ´»â€œå¡«å……â€æ··æ·†åŠŸèƒ½                                                                |
| -rm, â€“remove       | æ¿€æ´»â€œç§»é™¤â€æ··æ·†åŠŸèƒ½                                                                |

#### å·¥å…·ä½¿ç”¨æ ·ä¾‹

> python3.xintensio_obfuscator.py -d -i test/python/multiplefiles/basic/input/basicRAT -cpython -o test/python/multiplefiles/basic/output/basicRAT -m lower -r â€“rm

> python3.xintensio_obfuscator.py -d -i test/python/multiplefiles/advanced/input/basicRAT-c python -o test/python/multiplefiles/advanced/output/basicRAT -m high -r -p-rm

### 1.3 pyminifier

å¯¹ä»£ç å‹ç¼©ã€æ··æ·†ç­‰
[Github](https://github.com/liftoff/pyminifier)
[å®˜æ–¹æ–‡æ¡£](http://liftoff.github.io/pyminifier/)

### 1.4 Opy

[Github](https://github.com/QQuick/Opy)
OPY - Obfuscator for Python, string obfuscation added

### 1.5 pyobfuscate

[pyobfuscate](https://github.com/astrand/pyobfuscate) ç®—æ˜¯ä¸€ä¸ªé¢‡å…·å¹´å¤´çš„ Python ä»£ç æ··æ·†åº“äº†ï¼Œä½†å´æ˜¯â€œè€å½“ç›Šå£®â€äº†ã€‚
(ä¸€æ¬¡åªèƒ½æ··æ·†ä¸€ä¸ªæ–‡ä»¶ï¼Œå¥½åƒåªèƒ½ç”¨äº python 2)

```sh
git clone https://github.com/astrand/pyobfuscate.git
cd pyobfuscate/
python setup.py install
# ä½¿ç”¨
pyobfuscate example.py
```

---

## 2.åŠ å¯†

### å®šåˆ¶ python è§£é‡Šå™¨

ä»æºç ä¸‹æ‰‹ï¼šhttps://github.com/python/cpython/tree/3.6/Modules

å‡å®šæˆ‘ä»¬æœ‰ä¸€ä¸ªç®—æ³•ï¼Œèƒ½å¤ŸåŠ å¯†åŸå§‹çš„ Python ä»£ç ï¼Œè¿™äº›åŠ å¯†åä»£ç éšå‘è¡Œç¨‹åºä¸€èµ·ï¼Œå¯è¢«ä»»ä½•äººçœ‹åˆ°ï¼Œå´éš¾ä»¥ç ´è§£ã€‚å¦ä¸€æ–¹é¢ï¼Œæœ‰ä¸€ä¸ªå®šåˆ¶å¥½çš„ Python è§£é‡Šå™¨ï¼Œå®ƒèƒ½å¤Ÿè§£å¯†è¿™äº›è¢«åŠ å¯†çš„ä»£ç ï¼Œç„¶åè§£é‡Šæ‰§è¡Œã€‚è€Œç”±äº Python è§£é‡Šå™¨æœ¬èº«æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œäººä»¬ä¹Ÿå°±æ— æ³•ä»è§£é‡Šå™¨ä¸­è·å–è§£å¯†çš„å…³é”®æ•°æ®ã€‚ä»è€Œè¾¾åˆ°äº†ä¿æŠ¤æºç çš„ç›®çš„ã€‚

è¦å®ç°ä¸Šè¿°çš„è®¾æƒ³ï¼Œé¦–å…ˆéœ€è¦æŒæ¡åŸºæœ¬çš„åŠ è§£å¯†ç®—æ³•ï¼Œå…¶æ¬¡æ¢ç©¶ Python æ‰§è¡Œä»£ç çš„æ–¹å¼ä»è€Œäº†è§£åœ¨ä½•å¤„è¿›è¡ŒåŠ è§£å¯†ï¼Œæœ€åç¦ç”¨å­—èŠ‚ç ç”¨ä»¥é˜²æ­¢é€šè¿‡ .pyc åç¼–è¯‘ã€‚

---

å‚è€ƒæ–‡ç« :

- [B ä¹-ä½¿ç”¨ python è¯­è¨€å¦‚ä½•ä¿å¯†æºä»£ç ä»¥é˜²æ­¢é€†å‘å·¥ç¨‹ï¼Ÿ](https://www.zhihu.com/question/20069661)

- <https://docs.python.org/3/library>

- <https://blog.csdn.net/submarineas/article/details/93723421#_170>

- <https://blog.csdn.net/Gavinmiaoc/article/details/84340736>

- <https://blog.csdn.net/qq_34106574/article/details/81166062>

- <https://zhuanlan.zhihu.com/p/54296517>

- <https://www.freebuf.com/sectool/205926.html>

- <https://blog.csdn.net/kwame211/article/details/79202074>

- [python è½¬ c++å·¥å…· shedskin](https://blog.csdn.net/mangobar/article/details/81215019)

- [å¦‚ä½•ä¿æŠ¤ä½ çš„ Python ä»£ç  ï¼ˆä¸€ï¼‰â€”â€” ç°æœ‰åŠ å¯†æ–¹æ¡ˆ](https://zhuanlan.zhihu.com/p/54296517)

- [å¦‚ä½•ä¿æŠ¤ä½ çš„ Python ä»£ç  ï¼ˆäºŒï¼‰â€”â€” å®šåˆ¶ Python è§£é‡Šå™¨](https://zhuanlan.zhihu.com/p/54297880)
